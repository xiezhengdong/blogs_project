<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>踏雪寻梅-博客</title>
<meta name="Keywords" content="" >
<meta name="Description" content="" >
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Javascript常用的技巧 - 梦影雾花 - 个人博客 - 云在青天水在瓶</title>
    <meta name="author" content="梦影雾花">
    <meta name="keywords" content="javascript常用的技巧,javascript," />
    <meta name="description" content="Javascript常用的技巧" />



    <link href="http://www.mywhblog.cn/assets/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
<link href="http://www.mywhblog.cn/fonts/css/font-awesome.min.css" rel="stylesheet"/>
<link href="http://www.mywhblog.cn/Content/css/offcanvas.min.css" rel="stylesheet"/>
<link href="http://www.mywhblog.cn/Content/css/style.css" rel="stylesheet"/>
<link href="http://www.mywhblog.cn/Content/css/index.css" rel="stylesheet"/>

    <style type="text/css">
        * {
            cursor: url(/assets/xj6/normal.cur),default;
        }

        a {
            cursor: url(/assets/xj6/link.cur),default !important;
        }
    </style>



<link href="/static/css/styles.css" rel="stylesheet">
<!--[if lt IE 9]>
<script src="js/modernizr.js"></script>
<![endif]-->
<script src="/static/js/jquery-3.3.1.min.js"></script>
<script src="/static/js/main.js"></script>
</head>

<header>
<a href="/blog/index/" id="logo"><img src="/static/images/logo.png" alt=""/><h1>雪寻梅</h1></a>
 <div id="wrap-menu">
   <ul id="header-menu">
     <li ><a href="/blog/index/">网站首页</a></li>
     <li><a href="/">个人档案</a>
        <ul class="second-lvl">
           <li><a href="/">关于我</a></li>
           <li><a href="/">我的相册</a></li>
           <li><a href="/">我的作品</a></li>
         </ul>
      </li>
      <li><a href="http://www.cnblogs.com/Huangsh2017Come-on/" target="_blank">个人博客</a></li>
      <li><a href="/">技术探讨</a>
         <ul class="second-lvl">
           <li><a href="/blog/python/page/?num=1">python</a></li>
           <li><a href="/blog/django/page/?num=1">django</a></li>
             <li><a href="/blog/django/">java</a></li>
           <li><a href="/">javascripts</a>
               <ul class="third-lvl">
                  <li><a href="/">js的闭包实现</a></li>
                  <li><a href="/">js面向对象</a></li>
                </ul>
            </li>
           </ul>
        </li>
      <li><a href="/">机器学习</a>
         <ul class="second-lvl">
           <li><a href="/blog/python/">中文分词</a></li>
           <li><a href="/blog/django/">贝叶斯分类器</a></li>
           <li><a href="/">聚类</a>
               <ul class="third-lvl">
                  <li><a href="/">js的闭包实现</a></li>
                  <li><a href="/">js面向对象</a></li>
                </ul>
            </li>
           </ul>
        </li>

        <li><a href="/blog/liuyan/" target="_blank">爬虫世界</a></li>

    </ul>
</div>
</header>



<body>
<head>
  <meta charset="utf-8">

  <title>Python 中的单例模式 | FunHacks</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="单例模式单例模式（Singleton Pattern）是一种常用的软件设计模式，该模式的主要目的是确保某一个类只有一个实例存在。当你希望在整个系统中，某个类只能出现一个实例时，单例对象就能派上用场。
比如，某个服务器程序的配置信息存放在一个文件中，客户端通过一个 AppConfig 的类来读取配置文件的信息。如果在程序运行期间，有很多地方都需要使用配置文件的内容，也就是说，很多地方都需要创建 Ap">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 中的单例模式">
<meta property="og:url" content="http://funhacks.net/2017/01/17/singleton/index.html">
<meta property="og:site_name" content="FunHacks">
<meta property="og:description" content="单例模式单例模式（Singleton Pattern）是一种常用的软件设计模式，该模式的主要目的是确保某一个类只有一个实例存在。当你希望在整个系统中，某个类只能出现一个实例时，单例对象就能派上用场。
比如，某个服务器程序的配置信息存放在一个文件中，客户端通过一个 AppConfig 的类来读取配置文件的信息。如果在程序运行期间，有很多地方都需要使用配置文件的内容，也就是说，很多地方都需要创建 Ap">
<meta property="og:updated_time" content="2017-02-12T04:28:49.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python 中的单例模式">
<meta name="twitter:description" content="单例模式单例模式（Singleton Pattern）是一种常用的软件设计模式，该模式的主要目的是确保某一个类只有一个实例存在。当你希望在整个系统中，某个类只能出现一个实例时，单例对象就能派上用场。
比如，某个服务器程序的配置信息存放在一个文件中，客户端通过一个 AppConfig 的类来读取配置文件的信息。如果在程序运行期间，有很多地方都需要使用配置文件的内容，也就是说，很多地方都需要创建 Ap">

    <link rel="alternate" href="http://funhacks.net/atom.xml" title="FunHacks" type="application/atom+xml">
    <link rel="icon" href="http://funhacks.net/favicon.ico">

  <link rel="stylesheet" href="http://funhacks.net/css/style.css">

<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-62960961-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>


  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">

    <div id="header-inner" class="inner">
      <nav id="sub-nav">

          <a id="nav-rss-link" class="nav-icon" href="http://funhacks.net/atom.xml" title="RSS Feed"></a>

        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://funhacks.net"></form>
      </div>

    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-singleton" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/17/singleton/" class="article-date">
  <time datetime="2017-01-17T01:20:00.000Z" itemprop="datePublished">2017-01-17</time>
</a>

  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">


      <header class="article-header">


    <h1 class="article-title" itemprop="name">
      Python 中的单例模式
    </h1>


      </header>

    <div class="article-entry" itemprop="articleBody">

        <!-- Table of Contents -->

        <h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p><strong>单例模式（Singleton Pattern）</strong>是一种常用的软件设计模式，该模式的主要目的是确保<strong>某一个类只有一个实例存在</strong>。当你希望在整个系统中，某个类只能出现一个实例时，单例对象就能派上用场。</p>
<p>比如，某个服务器程序的配置信息存放在一个文件中，客户端通过一个 AppConfig 的类来读取配置文件的信息。如果在程序运行期间，有很多地方都需要使用配置文件的内容，也就是说，很多地方都需要创建 AppConfig 对象的实例，这就导致系统中存在多个 AppConfig 的实例对象，而这样会严重浪费内存资源，尤其是在配置文件内容很多的情况下。事实上，类似 AppConfig 这样的类，我们希望在程序运行期间只存在一个实例对象。</p>
<p>在 Python 中，我们可以用多种方法来实现单例模式：</p>
<ul>
<li>使用模块</li>
<li>使用 <code>__new__</code></li>
<li>使用装饰器（decorator）</li>
<li>使用元类（metaclass）</li>
</ul>
<a id="more"></a>
<h1 id="使用模块"><a href="#使用模块" class="headerlink" title="使用模块"></a>使用模块</h1><p>其实，<strong>Python 的模块就是天然的单例模式</strong>，因为模块在第一次导入时，会生成 <code>.pyc</code> 文件，当第二次导入时，就会直接加载 <code>.pyc</code> 文件，而不会再次执行模块代码。因此，我们只需把相关的函数和数据定义在一个模块中，就可以获得一个单例对象了。如果我们真的想要一个单例类，可以考虑这样做：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># mysingleton.py</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">My_Singleton</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">my_singleton = My_Singleton()</div></pre></td></tr></table></figure>
<p>将上面的代码保存在文件 <code>mysingleton.py</code> 中，然后这样使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">from mysingleton import my_singleton</div><div class="line"></div><div class="line">my_singleton.foo()</div></pre></td></tr></table></figure>
<h1 id="使用-new"><a href="#使用-new" class="headerlink" title="使用 __new__"></a>使用 <code>__new__</code></h1><p>为了使类只能出现一个实例，我们可以使用 <code>__new__</code> 来控制实例的创建过程，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></div><div class="line">    _instance = <span class="keyword">None</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kw)</span>:</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls._instance:</div><div class="line">            cls._instance = super(Singleton, cls).__new__(cls, *args, **kw)  </div><div class="line">        <span class="keyword">return</span> cls._instance  </div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(Singleton)</span>:</span>  </div><div class="line">    a = <span class="number">1</span></div></pre></td></tr></table></figure>
<p>在上面的代码中，我们将类的实例和一个类变量 <code>_instance</code> 关联起来，如果 <code>cls._instance</code> 为 None 则创建实例，否则直接返回 <code>cls._instance</code>。</p>
<p>执行情况如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; one = MyClass()</div><div class="line">&gt;&gt;&gt; two = MyClass()</div><div class="line">&gt;&gt;&gt; one == two</div><div class="line">True</div><div class="line">&gt;&gt;&gt; one is two</div><div class="line">True</div><div class="line">&gt;&gt;&gt; id(one), id(two)</div><div class="line">(4303862608, 4303862608)</div></pre></td></tr></table></figure>
<h1 id="使用装饰器"><a href="#使用装饰器" class="headerlink" title="使用装饰器"></a>使用装饰器</h1><p>我们知道，装饰器（decorator）可以动态地修改一个类或函数的功能。这里，我们也可以使用装饰器来装饰某个类，使其只能生成一个实例，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls)</span>:</span></div><div class="line">    instances = &#123;&#125;</div><div class="line"><span class="meta">    @wraps(cls)</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getinstance</span><span class="params">(*args, **kw)</span>:</span></div><div class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> instances:</div><div class="line">            instances[cls] = cls(*args, **kw)</div><div class="line">        <span class="keyword">return</span> instances[cls]</div><div class="line">    <span class="keyword">return</span> getinstance</div><div class="line"></div><div class="line"><span class="meta">@singleton</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></div><div class="line">    a = <span class="number">1</span></div></pre></td></tr></table></figure>
<p>在上面，我们定义了一个装饰器 <code>singleton</code>，它返回了一个内部函数 <code>getinstance</code>，该函数会判断某个类是否在字典 <code>instances</code> 中，如果不存在，则会将 <code>cls</code> 作为 key，<code>cls(*args, **kw)</code> 作为 value 存到 <code>instances</code> 中，否则，直接返回 <code>instances[cls]</code>。</p>
<h1 id="使用-metaclass"><a href="#使用-metaclass" class="headerlink" title="使用 metaclass"></a>使用 metaclass</h1><p>元类（metaclass）可以控制类的创建过程，它主要做三件事：</p>
<ul>
<li>拦截类的创建</li>
<li>修改类的定义</li>
<li>返回修改后的类</li>
</ul>
<p>使用元类实现单例模式的代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(type)</span>:</span></div><div class="line">    _instances = &#123;&#125;</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(cls, *args, **kwargs)</span>:</span></div><div class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> cls._instances:</div><div class="line">            cls._instances[cls] = super(Singleton, cls).__call__(*args, **kwargs)</div><div class="line">        <span class="keyword">return</span> cls._instances[cls]</div><div class="line"></div><div class="line"><span class="comment"># Python2</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></div><div class="line">    __metaclass__ = Singleton</div><div class="line"></div><div class="line"><span class="comment"># Python3</span></div><div class="line"><span class="comment"># class MyClass(metaclass=Singleton):</span></div><div class="line"><span class="comment">#    pass</span></div></pre></td></tr></table></figure>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ul>
<li>Python 的模块是天然的单例模式，这在大部分情况下应该是够用的，当然，我们也可以使用装饰器、元类等方法</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://stackoverflow.com/questions/6760685/creating-a-singleton-in-python" target="_blank" rel="external">Creating a singleton in Python - Stack Overflow</a></li>
<li><a href="http://coolshell.cn/articles/265.html" target="_blank" rel="external">深入浅出单实例Singleton设计模式 | 酷 壳</a></li>
<li><a href="http://stackoverflow.com/questions/674304/pythons-use-of-new-and-init" target="_blank" rel="external">design patterns - Python’s use of <strong>new</strong> and <strong>init</strong>? - Stack Overflow</a></li>
</ul>


    </div>
    <footer class="article-footer">
      <a data-url="http://funhacks.net/2017/01/17/singleton/" data-id="cj1iv3ig9004a5u6gigjr2s8c" class="article-share-link">分享</a>

        <a href="http://funhacks.net/2017/01/17/singleton/#disqus_thread" class="article-comment-link">留言</a>


  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>

    </footer>
  </div>

<nav id="article-nav">

    <a href="/2017/02/13/itertools/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
          高效的 itertools 模块
      </div>
    </a>
    <a href="/2017/01/03/explore_python/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Python 之旅</div>
    </a>

</nav>

</article>

<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</section>

    <aside id="sidebar">

    <div class="widget-wrap">

      <div class="widget" id="toc-widget-fixed">

        <strong class="toc-title">目录</strong>
        <div class="toc-widget-list">
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#单例模式"><span class="toc-number">1.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用模块"><span class="toc-number">2.</span> <span class="toc-text">使用模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用-new"><span class="toc-number">3.</span> <span class="toc-text">使用 __new__</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用装饰器"><span class="toc-number">4.</span> <span class="toc-text">使用装饰器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用-metaclass"><span class="toc-number">5.</span> <span class="toc-text">使用 metaclass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#小结"><span class="toc-number">6.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考资料"><span class="toc-number">7.</span> <span class="toc-text">参考资料</span></a></li></ol>
          </div>
      </div>
    </div>

</aside>

      </div>
      <footer id="footer">

  <div class="outer">
    <div id="footer-left">
      &copy; 2015 - 2017 Ethan
    </div>
     <div id="footer-right">
      联系方式&nbsp;|&nbsp;funhacks@foxmail.com
    </div>
  </div>
</footer>
 <script src="http://funhacks.net/jquery/jquery.min.js"></script>

    </div>
    <nav id="mobile-nav">

    <a href="/" class="mobile-nav-link">首页</a>

    <a href="/archives" class="mobile-nav-link">归档</a>

    <a href="/about" class="mobile-nav-link">关于</a>

</nav>
    <img class="back-to-top-btn" src="http://funhacks.net/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>

<script>
  var disqus_shortname = 'funhacks';

  var disqus_url = 'http://funhacks.net/2017/01/17/singleton/';

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>





    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {inlineMath: [["$","$"], ["\\(","\\)"]]},
            TeX: {equationNumbers: {autoNumber: ["AMS"], useLabelIds: true }}
        });
    </script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>


 <script src="/js/is.js"></script>


  <link rel="stylesheet" href="http://funhacks.net/fancybox/jquery.fancybox.css">
  <script src="http://funhacks.net/fancybox/jquery.fancybox.pack.js"></script>


<script src="http://funhacks.net/js/script.js"></script>
<script src="http://funhacks.net/js/elevator.js"></script>

  </div>
</body>
</html>
</body>
</html>
